<!DOCTYPE html>
<html>
  <head>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"
    />
    <title>ModalBus Demo</title>

    <script src="https://cdn.plus4u.net/libs/systemjs/0.19.47/system.js"></script>
    <script>
      SystemJS.config({
        paths: {
          systemjs: "https://cdn.plus4u.net/libs/systemjs/0.19.47/system.js",
          react: "https://cdn.plus4u.net/libs/react/16.8.6/react.js",
          "react-dom": "https://cdn.plus4u.net/libs/react-dom/16.8.6/react-dom.js",
          "create-react-class": "https://cdn.plus4u.net/libs/create-react-class/15.6.3/create-react-class.js",
          "prop-types": "https://cdn.plus4u.net/libs/prop-types/15.7.2/prop-types.js",

          uu5stringg01: "https://cdn.plus4u.net/uu-uu5stringg01/1.0.0/uu5stringg01.js",
          uu5g05: "https://cdn.plus4u.net/uu-uu5g05/0.0.0/uu5g05.js",
          "uu5g05-elements": "https://cdn.plus4u.net/uu-uu5g05/0.0.0/uu5g05-elements.js",

          uu5g04: "/uu5g04.js",
          "uu5g04-bricks": "/uu5g04-bricks.js",
          "uu5g04-forms": "/uu5g04-forms.js",
          "uu5g04-hooks": "/uu5g04-hooks.js",
        },
      });
    </script>
  </head>
  <body>
    <div id="renderHere"></div>

    <script src="https://cdn.plus4u.net/uu-app-templateg01/1.0.0/in-browser-transpilation.js"></script>
    <script type="text/babel">
      import UU5 from "uu5g04";
      import { Fragment } from "uu5g05";
      import Uu5Elements from "uu5g05-elements";
      import "uu5g04-bricks";
      import "uu5g04-forms";
      import {
        useState,
        useMemo,
        useRef,
        useContext,
        useEffect,
        createComponent,
        createComponentWithRef,
        useImperativeHandle,
        createVisualComponent,
      } from "uu5g04-hooks";

      const Uu5g05ModalIfc = createComponentWithRef({
        render(props, ref) {
          const [open, setOpen] = useState(false);

          useImperativeHandle(ref, () => ({
            open() {
              setOpen(true);
            },
            close() {
              setOpen(false);
            },
          }));

          return <Uu5Elements.Modal2 {...props} onClose={() => setOpen(false)} open={open} />;
        },
      });

      class LoremIpsumUtil {
        static WORDS = [
          "lorem",
          "ipsum",
          "dolor",
          "sit",
          "amet",
          "consectetur",
          "adipiscing",
          "elit",
          "quisque",
          "faucibus",
          "ex",
          "sapien",
          "vitae",
          "pellentesque",
          "sem",
          "placerat",
          "in",
          "id",
          "cursus",
          "mi",
          "pretium",
          "tellus",
          "duis",
          "convallis",
          "tempus",
          "leo",
          "eu",
          "aenean",
          "sed",
          "diam",
          "urna",
          "tempor",
          "pulvinar",
          "vivamus",
          "fringilla",
          "lacus",
          "nec",
          "metus",
          "bibendum",
          "egestas",
          "iaculis",
          "massa",
          "nisl",
          "malesuada",
          "lacinia",
          "integer",
          "nunc",
          "posuere",
          "ut",
          "hendrerit",
          "semper",
          "vel",
          "class",
          "aptent",
          "taciti",
          "sociosqu",
          "ad",
          "litora",
          "torquent",
          "per",
          "conubia",
          "nostra",
          "inceptos",
          "himenaeos",
          "orci",
          "varius",
          "natoque",
          "penatibus",
          "et",
          "magnis",
          "dis",
          "parturient",
          "montes",
          "nascetur",
          "ridiculus",
          "mus",
          "donec",
          "rhoncus",
          "eros",
          "lobortis",
          "nulla",
          "molestie",
          "mattis",
          "scelerisque",
          "maximus",
          "eget",
          "fermentum",
          "odio",
          "phasellus",
          "non",
          "purus",
          "est",
          "efficitur",
          "laoreet",
          "mauris",
          "pharetra",
          "vestibulum",
          "fusce",
          "dictum",
          "risus",
          "blandit",
          "quis",
          "suspendisse",
          "aliquet",
          "nisi",
          "sodales",
          "consequat",
          "magna",
          "ante",
          "condimentum",
          "neque",
          "at",
          "luctus",
          "nibh",
          "finibus",
          "facilisis",
          "dapibus",
          "etiam",
          "interdum",
          "tortor",
          "ligula",
          "congue",
          "sollicitudin",
          "erat",
          "viverra",
          "ac",
          "tincidunt",
          "nam",
          "porta",
          "elementum",
          "a",
          "enim",
          "euismod",
          "quam",
          "justo",
          "lectus",
          "commodo",
          "augue",
          "arcu",
          "dignissim",
          "velit",
          "aliquam",
          "imperdiet",
          "mollis",
          "nullam",
          "volutpat",
          "porttitor",
          "ullamcorper",
          "rutrum",
          "gravida",
          "cras",
          "eleifend",
          "turpis",
          "fames",
          "primis",
          "vulputate",
          "ornare",
          "sagittis",
          "vehicula",
          "praesent",
          "dui",
          "felis",
          "venenatis",
          "ultrices",
          "proin",
          "libero",
          "feugiat",
          "tristique",
          "accumsan",
          "maecenas",
          "potenti",
          "ultricies",
          "habitant",
          "morbi",
          "senectus",
          "netus",
          "suscipit",
          "auctor",
          "curabitur",
          "facilisi",
          "cubilia",
          "curae",
          "hac",
          "habitasse",
          "platea",
          "dictumst",
        ];

        static createParagraph({ random, ...attrs }) {
          // Standard deviation percentage for words and sentences
          const stDevPercentage = 0.5;

          // Get a random word from Latin word list
          const getRandomWord = () => this.WORDS[Utils.Number.random(this.WORDS.length - 1)];

          // Get a specific word from Latin word list
          const getWord = (i) => this.WORDS[i % this.WORDS.length];

          // Get a punctuation for middle of the sentence randomly
          const midPunctuation = (sentenceLength) => {
            const punctuations = [",", ";"];
            let punctuation;
            let position;
            if (sentenceLength > 6) {
              // 25% probability for punctuation
              const hasPunctuation = Math.random() <= 0.25;
              if (hasPunctuation) {
                position = Utils.Number.random(sentenceLength - 3, 2);
                punctuation = punctuations[Utils.Number.random(punctuations.length - 1)];
              }
            }
            return { punctuation, position };
          };

          // Get a punctuation for end of the sentence randomly
          const endPunctuation = () => {
            const random = Math.random();
            // 1% probability exclamation mark, 4% probability question mark, 95% probability dot
            if (random > 0.99) return "!";
            if (random > 0.95) return "?";
            return ".";
          };

          // Create a Sentence by using random words
          const createSentence = ({ withLoremIpsum, avgWords = 8 }) => {
            if (withLoremIpsum) return "Lorem ipsum odor amet, consectetuer adipiscing elit.";
            const stDev = Math.ceil(avgWords * stDevPercentage);
            const sentenceLength = Math.max(1, Utils.Number.random(avgWords + stDev, avgWords - stDev));
            const midPunc = midPunctuation(sentenceLength);

            let sentence = "";
            for (let i = 0; i < sentenceLength; i += 1) {
              sentence += `${getRandomWord()}${midPunc.position === i ? midPunc.punctuation : ""} `;
            }
            sentence = `${sentence.charAt(0).toUpperCase() + sentence.substr(1).trim()}${endPunctuation()}`;
            return sentence;
          };

          // Creates always the same text, averages are used as exacts.
          const createStandardParagraph = ({ avgWords = 8, avgSentences = 8 }) => {
            let paragraph = [];

            for (let i = 0; i < avgSentences; i += 1) {
              let sentence = "";
              for (let j = 0; j < avgWords; j += 1) {
                sentence += `${getWord(i * avgSentences + j)} `;
              }
              paragraph.push(sentence.charAt(0).toUpperCase() + sentence.slice(1).trim() + ".");
            }
            return paragraph.join(" ");
          };

          // Create a paragraph by joining sentences
          const createRandomParagraph = ({ firstParagraph, avgWords, avgSentences, startLoremIpsum }) => {
            const stDev = Math.ceil(avgSentences * stDevPercentage);
            const paragraphLength = Math.max(1, Utils.Number.random(avgSentences - stDev, avgSentences + stDev));

            let paragraph = [];
            for (let i = 0; i < paragraphLength; i += 1) {
              paragraph.push(
                createSentence({
                  withLoremIpsum: i === 0 && firstParagraph && startLoremIpsum,
                  avgWords,
                })
              );
            }
            return paragraph.join(" ");
          };

          return random ? createRandomParagraph(attrs) : createStandardParagraph(attrs);
        }
      }

      const LoremIpsum = createComponent({
        defaultProps: {
          paragraphCount: 1,
          random: true,
          avgWords: 8,
          avgSentences: 10,
          startLoremIpsum: true,
        },

        render({ paragraphCount, random, avgWords, avgSentences, startLoremIpsum }) {
          return (
            <Fragment>
              {Array.from({ length: paragraphCount }, (_, i) => (
                <p key={i}>
                  {LoremIpsumUtil.createParagraph({
                    random,
                    firstParagraph: i === 0,
                    avgWords,
                    avgSentences,
                    startLoremIpsum,
                  })}
                </p>
              ))}
            </Fragment>
          );
        },
      });

      function DemoModal(props) {
        const { label, ...modalProps } = props;
        let [open, setOpen] = useState(false);

        return (
          <Fragment>
            <Uu5Elements.Button onClick={() => setOpen(true)}>{label}</Uu5Elements.Button>
            <Uu5Elements.Modal
              actionList={[{ icon: "mdi-check", significance: "subdued", onClick: () => alert("click") }]}
              {...modalProps}
              open={open}
              onClose={() => setOpen(false)}
            />
          </Fragment>
        );
      }

      function DemoModalLegacy(props) {
        const { label, ...modalProps } = props;
        const modalRef = useRef();
        return (
          <Fragment>
            <Uu5Elements.Button onClick={() => modalRef.current.open(modalProps)}>{label}</Uu5Elements.Button>
            <UU5.Bricks.Modal location="portal" ref_={modalRef} {...modalProps} />
          </Fragment>
        );
      }

      function Page() {
        let modals = (
          <DemoModalLegacy label="Modal 1 legacy" header="Modal 1 legacy">
            <DemoModal label="Modal 2: closeOnEsc=false" header="Modal 2" closeOnEsc={false}>
              <DemoModal label="Modal 3: closeOnOverlayClick=false" header="Modal 3" closeOnOverlayClick={false}>
                <DemoModal label="Modal 4" header="Modal 4">
                  <DemoModalLegacy label="Modal 5 legacy" header="Modal 5 legacy">
                    <DemoModal label="Modal 6" header="Modal 6">
                      <LoremIpsum random={false} paragraphCount={1} />
                    </DemoModal>
                    <LoremIpsum random={false} paragraphCount={5} />
                  </DemoModalLegacy>
                  <LoremIpsum random={false} paragraphCount={10} />
                </DemoModal>
                <LoremIpsum random={false} paragraphCount={5} />
              </DemoModal>
              <LoremIpsum random={false} paragraphCount={2} />
            </DemoModal>
            <LoremIpsum random={false} paragraphCount={4} />
          </DemoModalLegacy>
        );
        return (
          <div>
            <div>
              uu5g05 ModalBus:
              <Uu5Elements.ModalBus>{modals}</Uu5Elements.ModalBus>
            </div>
            <div>
              Legacy ModalBus:
              <UU5.Bricks.ModalBus>{modals}</UU5.Bricks.ModalBus>
            </div>
            <div>
              Without modal bus:
              {modals}
            </div>
            <LoremIpsum random={false} paragraphCount={5} />
          </div>
        );
      }

      UU5.Common.DOM.render(<Page />, document.getElementById("renderHere"));
    </script>
  </body>
</html>
