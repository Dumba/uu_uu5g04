<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
  <title>ContextMenu Demo</title>

  <script>
    // var appBaseUrlPath = (location.pathname.split(/\//).slice(0,1+2).join("/")+"/").replace(/\/+/g,"/").replace(/"/g,"");
    // var appAssetsRelativeUrlPath = "public/";
    // document.write('<base href="' + appBaseUrlPath + appAssetsRelativeUrlPath + '" data-uu-app-base="' + appBaseUrlPath + '" data-uu-app-assets-base="' + appAssetsRelativeUrlPath + '">');
  </script>

  <link type="text/css" rel="stylesheet"
        href="https://cdn.plus4u.net/libs/materialdesignicons/3.5.95/css/materialdesignicons.css">
  <script src="https://cdn.plus4u.net/libs/systemjs/0.19.47/system.js"></script>

  <script>
    SystemJS.config({
      "paths": {
        "systemjs": "https://cdn.plus4u.net/libs/systemjs/0.19.47/system.js",
        "react": "https://cdn.plus4u.net/libs/react/16.8.6/react.js",
        "react-dom": "https://cdn.plus4u.net/libs/react-dom/16.8.6/react-dom.js",
        "create-react-class": "https://cdn.plus4u.net/libs/create-react-class/15.6.3/create-react-class.js",
        "prop-types": "https://cdn.plus4u.net/libs/prop-types/15.7.2/prop-types.js",
        "uu_appg01_core": "https://cdn.plus4u.net/uu-appg01-core/3.0.0/uu_appg01_core.min.js",
        "uu_appg01": "https://cdn.plus4u.net/uu-appg01/3.0.0/uu_appg01-base.min.js",
        "uu_oidcg01": "https://cdn.plus4u.net/uu-oidcg01/3.0.0/uu_oidcg01.min.js",

        "uu5g04": "/uu5g04.js",
        "uu5g04-bricks": "/uu5g04-bricks.js"
      }
    });

    // SystemJS.set("UU_ENVIRONMENT", SystemJS.newModule({"__useDefault": true, "default": {
    //   "uuoidc.redirectUri":"callbacks/login-callback.html"
    // }}));
  </script>

  <style>
    .div {
      position: relative;
      width: 250px;
      height: 500px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background-color: orange;
      overflow: visible;
    }

    .div-overflow-hidden {
      overflow: hidden;
    }

    .div-absolute {
      position: absolute;
      left: 980px;
      top: 250px;
      background-color: green;
    }

    .div-fixed {
      position: fixed;
      left: 200px;
      top: 200px;
      background-color: yellow;
    }

    .div-zindex-0 {
      z-index: 0;
    }

    .div-zindex-10 {
      z-index: 10;
    }
  </style>

</head>
<body>
<div id="renderHere"></div>

<!--<script src="https://cdn.plus4u.net/uu-appg01-template/1.0.0/in-browser-transpilation.min.js"></script>-->
<script src="https://cdn.plus4u.net/uu-appg01-template/1.0.0/in-browser-transpilation.js"></script>
<script type="text/babel">
  import React from "react";
  import createReactClass from "create-react-class";
  import PropTypes from "prop-types";
  import ReactDOM from "react-dom";
  import UU5 from "uu5g04";
  import "uu5g04-bricks";


  let MyPanel = createReactClass({
    mixins: [
      UU5.Common.BaseMixin,
      UU5.Common.ElementaryMixin
    ],

    statics: {
      tagName: 'MyPanel',
      classNames: {
        main: 'my-panel'
      }
    },
    //@@viewOff:statics

    //@@viewOn:propTypes
    propTypes: {
      header: PropTypes.string,
      color: PropTypes.string
    },

    getInitialState() {
      return {
        color: this.props.color
      }
    },

    setColor(color) {
      this.setState({color: color})
    },

    render() {
      return (
        <div {...this.getMainAttrs()} id={this.getId()}>
          <UU5.Bricks.Panel header={this.props.header} colorSchema={this.state.color}/>
        </div>
      );
    }

  });

  let Page = createReactClass({
    mixins: [UU5.Common.BaseMixin, UU5.Common.ElementaryMixin, UU5.Common.CcrReaderMixin],

    getInitialState() {
      return {
        color: 'info'
      }
    },

    componentDidMount() {
      window.addEventListener('contextmenu', this._onContextMenu, false);
      window.addEventListener('touchstart', this._touchStart, false);
      window.addEventListener('touchend', this._touchEnd, false);
    },

    _getTarget(item) {
      let result;
      let parent = item.parentElement;
      if (parent.id && this._flc.getRenderedChildrenIdList()[parent.id]) {
        result = this._flc.getRenderedChildrenIdList()[parent.id];
      } else if (parent) {
        result = this._getTarget(parent);
      }
      return result;
    },

    _touchStart(ev) {
      this.timer = setTimeout(this._onContextMenu.bind(this, ev), 500);
    },

    _touchEnd() {
      if (this.timer)
        clearTimeout(this.timer);
    },

    _onContextMenu(ev) {
      ev.preventDefault();
      ev.stopPropagation();

      let target;

      let children = this._flc.getRenderedChildrenIdList();
      if (ev.path) {

        ev.path.forEach((item) => {
          if (item.id && children[item.id]) {
            target = children[item.id];
          }
        });
      } else {
        // this part of code is for web browsers which don't know
        // event.path (IE, Edge)
        let item = ev.target;
        if (item.id && children[item.id]) {
          target = children[item.id];
        } else {
          target = this._getTarget(item);
        }
      }

      this.getCcrComponentByKey('contextMenu').open({
        event: ev,
        content: [
          {
            tag: 'UU5.Bricks.ContextMenu.Item',
            props: {
              label: "Set warning",
              onClick: function (opt) {
                opt.component.close(function () {
                  target && target.setColor('warning');
                })
              }
            }
          },
          {
            tag: 'UU5.Bricks.ContextMenu.Item',
            props: {
              label: "Set danger",
              onClick: function (opt) {
                opt.component.close(function () {
                  target && target.setColor('danger');
                })
              }
            }
          }
        ]
      });

      return false
    },

    render: function () {
      return (
        <UU5.Bricks.Page>
        <UU5.Bricks.Container header="UU5.Bricks.ContextMenu">

          <UU5.Bricks.Row nestingLevel="boxCollection">
            <UU5.Bricks.ContextMenu ccrKey="contextMenu" header='Header' footer='Footer'>
              <UU5.Bricks.ContextMenu.Item
                label="Ráno"
                onClick={(opt) => {
                  console.log(opt);
                  opt.component.close();
                }}
                icon="mdi-weather-sunset-up"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Dopoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="V poledne"
                icon="mdi-weather-sunny"
                space
                disabled
              />
              <UU5.Bricks.ContextMenu.Item
                label="Odpoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Večer"
                icon="mdi-weather-sunset"
              />
              <UU5.Bricks.ContextMenu.Item
                divider
              />
              <UU5.Bricks.ContextMenu.Item
                label="Vlastní"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Nějaké další"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Úplně jiné"
                disabled
              />
            </UU5.Bricks.ContextMenu>

            <UU5.Bricks.Column>
              <UU5.Bricks.Section className='center' header='Nested context menu'>
                <UU5.Bricks.Button
                  content="open nested context-menu"
                  onClick={(button, e) => {
                    this.getCcrComponentByKey('nestedContextMenu').open({
                      event: e,
                      onOpenCallback: () => {
                        console.log('automatic open callback')
                      }
                    })
                  }}/>
                <UU5.Bricks.ContextMenu ccrKey="nestedContextMenu" header='Header' footer='Footer'>

                  <UU5.Bricks.ContextMenu.Item
                    label="Submenu"
                  >
                    <UU5.Bricks.ContextMenu.Item
                      label="V poledne"
                      icon="mdi-weather-sunny"
                      disabled

                    />
                    <UU5.Bricks.ContextMenu.Item
                      space
                      label="Odpoledne"

                    />
                    <UU5.Bricks.ContextMenu.Item
                      label="Večer"
                      icon="mdi-weather-sunset"
                    />
                    <UU5.Bricks.ContextMenu.Item
                      divider
                    />
                    <UU5.Bricks.ContextMenu.Item
                      label="Vlastní"
                    >
                      <UU5.Bricks.ContextMenu.Item
                        label="Večer"
                        icon="mdi-weather-sunset"
                      />
                      <UU5.Bricks.ContextMenu.Item
                        divider
                      />
                      <UU5.Bricks.ContextMenu.Item
                        label="evening"
                        icon="mdi-weather-sunset"
                      />

                    </UU5.Bricks.ContextMenu.Item>
                  </UU5.Bricks.ContextMenu.Item>

                  <UU5.Bricks.ContextMenu.Item
                    label="Nějaké další"
                  />
                  <UU5.Bricks.ContextMenu.Item
                    label="Úplně jiné"
                    disabled
                  />
                </UU5.Bricks.ContextMenu>


              </UU5.Bricks.Section>
            </UU5.Bricks.Column>

            <UU5.Bricks.Column>
              <UU5.Bricks.Button
                onClick={(button, e) => {
                  this.getCcrComponentByKey('contextMenu').open({
                    event: e,
                    onOpenCallback: () => {
                      console.log('automatic open callback')
                    }
                  });
                }}
                content="Magic"/>

              <UU5.Bricks.Button
                onClick={() => {
                  this.getCcrComponentByKey('contextMenu').close(() => {
                    console.log('closed callback')

                    console.log('flc', this._flc)
                  });
                }}
                content="Close"/>
            </UU5.Bricks.Column>
            <UU5.Bricks.Column
              className='unselectable'
              ref_={(flc) => this._flc = flc}
            >
              <MyPanel header='right click me' color={this.state.color}/>
              <MyPanel header='right click me' color={this.state.color}/>
              <MyPanel header='right click me' color={this.state.color}/>
              <MyPanel header='right click me' color={this.state.color}/>
            </UU5.Bricks.Column>



          </UU5.Bricks.Row>

          <UU5.Bricks.Div className="div div-fixed div-zindex-0">

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu4').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="position fixed"
            />

            <UU5.Bricks.ContextMenu ccrKey="contextMenu4" header='Header' footer='Footer'>
              <UU5.Bricks.ContextMenu.Item
                label="Ráno"
                onClick={(opt) => {
                  console.log(opt);
                  opt.component.close();
                }}
                icon="mdi-weather-sunset-up"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Dopoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="V poledne"
                icon="mdi-weather-sunny"
                space
                disabled
              />
              <UU5.Bricks.ContextMenu.Item
                label="Odpoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Večer"
                icon="mdi-weather-sunset"
              />
              <UU5.Bricks.ContextMenu.Item
                divider
              />
              <UU5.Bricks.ContextMenu.Item
                label="Vlastní"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Nějaké další"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Úplně jiné"
                disabled
              />
              <UU5.Bricks.ContextMenu.Item
                label="href + onClick"
                href="https://www.plus4u.net/"
                target="_blank"
                ref_={(item) => this._itemHrefClick = item}
                onClick={(component) => {
                  component.event.stopPropagation();
                  component.event.preventDefault();
                  console.log(this._itemHrefClick.findDOMNode());
                }}
              />
              <UU5.Bricks.ContextMenu.Item
                label="href"
                href="https://www.plus4u.net/"
                target="_blank"
              />
            </UU5.Bricks.ContextMenu>

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu4').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="position fixed"
            />
          </UU5.Bricks.Div>

          <UU5.Bricks.Div className="div div-absolute div-zindex-10">

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu3').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="position absolute"
            />

            <UU5.Bricks.ContextMenu ccrKey="contextMenu3" header='Header' footer='Footer'>
              <UU5.Bricks.ContextMenu.Item
                label="Ráno"
                onClick={(opt) => {
                  console.log(opt);
                  opt.component.close();
                }}
                icon="mdi-weather-sunset-up"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Dopoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="V poledne"
                icon="mdi-weather-sunny"
                space
                disabled
              />
              <UU5.Bricks.ContextMenu.Item
                label="Odpoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Večer"
                icon="mdi-weather-sunset"
              />
              <UU5.Bricks.ContextMenu.Item
                divider
              />
              <UU5.Bricks.ContextMenu.Item
                label="Vlastní"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Nějaké další"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Úplně jiné"
                disabled
              />
            </UU5.Bricks.ContextMenu>

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu3').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="position absolute"
            />
          </UU5.Bricks.Div>


          <UU5.Bricks.Div className="div div-overflow-hidden">

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu2').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="overflow"
            />

            <UU5.Bricks.ContextMenu ccrKey="contextMenu2" header='Header' footer='Footer'>
              <UU5.Bricks.ContextMenu.Item
                label="Ráno"
                onClick={(opt) => {
                  console.log(opt);
                  opt.component.close();
                }}
                icon="mdi-weather-sunset-up"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Dopoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="V poledne"
                icon="mdi-weather-sunny"
                space
                disabled
              />
              <UU5.Bricks.ContextMenu.Item
                label="Odpoledne"
                space
              />
              <UU5.Bricks.ContextMenu.Item
                label="Večer"
                icon="mdi-weather-sunset"
              />
              <UU5.Bricks.ContextMenu.Item
                divider
              />
              <UU5.Bricks.ContextMenu.Item
                label="Vlastní"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Nějaké další"
              />
              <UU5.Bricks.ContextMenu.Item
                label="Úplně jiné"
                disabled
              />
            </UU5.Bricks.ContextMenu>

            <UU5.Bricks.Button
              onClick={(button, e) => {
                this.getCcrComponentByKey('contextMenu2').open({
                  event: e,
                  onOpenCallback: () => {
                    console.log('automatic open callback')
                  }
                })
              }}
              content="overflow"
            />
          </UU5.Bricks.Div>


          <UU5.Bricks.Column>
            <UU5.Bricks.Section className='center' header='Nested context menu'>
              <UU5.Bricks.Button
                content="open nested context-menu"
                onClick={(button, e) => {
                  this.getCcrComponentByKey('nestedContextMenu').open({
                    event: e,
                    onOpenCallback: () => {
                      console.log('automatic open callback')
                    },
                    classNames: ["koleno"]
                  })
                }}/>

              <UU5.Bricks.Paragraph/>
              <UU5.Bricks.ContextMenu ccrKey="nestedContextMenu" header='Header' footer='Footer'>



                <UU5.Bricks.ContextMenu.Item
                  label="Nějaké další"
                />
                <UU5.Bricks.ContextMenu.Item
                  label="Úplně jiné"
                  disabled
                />
                <UU5.Bricks.ContextMenu.Item
                  label="Nějaké další"
                />
                <UU5.Bricks.ContextMenu.Item
                  label="Submenu"
                >
                  <UU5.Bricks.ContextMenu.Item
                    label="V poledne"
                    icon="mdi-weather-sunny"
                    disabled

                  />
                  <UU5.Bricks.ContextMenu.Item
                    space
                    label="Odpoledne"

                  />
                  <UU5.Bricks.ContextMenu.Item
                    label="Večer"
                    icon="mdi-weather-sunset"
                  />
                  <UU5.Bricks.ContextMenu.Item
                    label="Večer"
                    icon="mdi-weather-sunset"
                  />
                  <UU5.Bricks.ContextMenu.Item
                    divider
                  />
                  <UU5.Bricks.ContextMenu.Item
                    label="Vlastní"
                  >
                    <UU5.Bricks.ContextMenu.Item
                      label="Večer"
                      icon="mdi-weather-sunset"
                    />
                    <UU5.Bricks.ContextMenu.Item
                      divider
                    />
                    <UU5.Bricks.ContextMenu.Item
                      label="evening"
                      icon="mdi-weather-sunset"
                    />
                    <UU5.Bricks.ContextMenu.Item
                      label="Nějaké další"
                    />

                  </UU5.Bricks.ContextMenu.Item>
                </UU5.Bricks.ContextMenu.Item>
                <UU5.Bricks.ContextMenu.Item
                  label="Nějaké další"
                />
              </UU5.Bricks.ContextMenu>
            </UU5.Bricks.Section>
          </UU5.Bricks.Column>
        </UU5.Bricks.Container>
        </UU5.Bricks.Page>
      );
    }
  });

  ReactDOM.render(React.createElement(Page, null), document.getElementById('renderHere'));
</script>
</body>
</html>
